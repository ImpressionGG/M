function oo = new(o,varargin)          % ANTENNA New Method              
%
% NEW   New ANTENNA object
%
%           oo = new(o,'Menu')         % menu setup
%
%           o = new(antenna,'Polar')   % polar antenna data (type 'pol')
%           o = new(antenna,'Antenna') % 3D antenna data (type 'ant')
%           o = new(antenna,'Measured')% 3D antenna measured data (type 'ant')
%
%       See also: ANTENNA, PLOT, ANALYSIS, STUDY
%
   [gamma,oo] = manage(o,varargin,@Polar,@Antenna,@Measured,@Menu);
   oo = gamma(oo);
end

%==========================================================================
% Menu Setup
%==========================================================================

function oo = Menu(o)                  % Setup Menu                    
   oo = mitem(o,'Polar',{@Callback,'Polar'},[]);
   oo = mitem(o,'-');
   oo = mitem(o,'Antenna',{@Callback,'Antenna'},[]);
   oo = mitem(o,'Measured Data',{@Callback,'Measured'},[]);
end
function oo = Callback(o)                                              
   mode = arg(o,1);
   oo = new(o,mode);
   paste(o,oo);                        % paste object into shell
end

%==========================================================================
% New Polar Object
%==========================================================================

function oo = Polar(o)                 % New wave object
   phi = -180:1:180;
   k = abs(0.5+2*randn);
   noise = 0.8*randn(size(phi));
   db = 30*cos(k*phi * pi/180) + 5*cos(5*k*phi * pi/180) + noise;

      % pack into object

   oo = antenna('pol');                % polar data type
   oo = data(oo,'phi,db',phi,db);
   oo = opt(oo,'min,max',-80,50);

   oo.par.title = sprintf('Polar Antenna Data (%s)',datestr(now));
end

%==========================================================================
% New Antenna Object
%==========================================================================

function oo = Antenna(o)               % New Antenna Object
   gamma = [-90 -80 -70 -60 -50 -40 -30 -20 -10 ...
              0 10 20 30 40 50 60 70 80 90 ];
           
   m = 37;  n = 19;                    % sizes of phi and rho
   n_az = 36;
 
   f = -5 + 10/90^2 * gamma.*gamma;    % rho characteristics

   rho = (1+0.05*abs(randn(m,1))) * f;
   phi = (0:10:360)' * ones(1,n);

   oo = antenna('ant');                % create 'ant' typed ANTENNA object
   oo = data(oo,'phi,rho,gamma,n_az',phi,rho,gamma,n_az);
   
   oo.par.title = sprintf('3D Antenna Data (%s)',datestr(now));
end

%==========================================================================
% New Antenna Object with Measured Data
%==========================================================================

function oo = Measured(o)              % New Object with Measured Data
   gamma = [-90 -80 -70 -60 -50 -40 -30 -20 -10 ...
              0 10 20 30 40 50 60 70 80 90 ];
   phi = (0:10:360)' * ones(1,19);
   rho = Rho(o);
   n_az = 36;
 
   oo = antenna('ant');                % create 'ant' typed ANTENNA object
   oo = data(oo,'phi,rho,gamma,n_az',phi,rho,gamma,n_az);
   
   oo.par.title = sprintf('3D Measured Antenna Data (%s)',datestr(now));
end
function rho = Rho(o)
   rho = [
   27.0028   26.4762   25.4537   23.9945   22.2355   21.5544   22.7059   24.3620   25.7010   26.2991
   27.1494   26.4965   25.4848   24.0095   22.2661   21.5809   22.7582   24.4022   25.7119   26.3087
   25.5876   25.0786   24.2411   23.0397   21.8908   21.5332   22.5310   23.8102   25.0879   25.6840
   23.7450   23.3607   23.0380   22.8581   22.2474   21.2883   21.3217   22.3106   23.4399   24.2564
   24.3047   23.9333   24.1708   24.1141   23.7476   23.2663   21.2056   20.2605   20.6038   21.6779
   25.6542   25.5192   25.9584   25.9247   26.0713   25.2382   24.3645   21.5573   19.5544   18.4969
   27.2320   26.9981   27.4461   27.8134   27.8919   27.0221   26.1306   23.9551   21.9387   18.8303
   28.3597   28.6047   28.5424   28.7667   28.6940   28.0813   27.0517   25.6028   23.3778   20.1187
   29.4856   29.5993   29.2495   29.2433   28.8759   28.2811   27.2086   25.7102   23.5443   20.4541
   30.4067   30.2081   29.8529   29.3445   28.8453   28.0917   26.8968   25.3056   23.0530   19.6593
   30.5425   30.3212   29.8946   29.3260   28.5764   27.5967   26.1877   24.3355   21.6816   17.0113
   30.4722   30.2660   29.7402   29.1107   28.2444   27.1483   25.6428   23.6085   20.3629   15.8148
   29.9867   29.7944   29.3006   28.6778   27.8828   26.8121   25.4342   23.8673   22.1885   20.3696
   29.0674   28.9111   28.4082   27.9054   27.2226   26.3338   25.3623   24.8831   24.3015   23.8420
   27.4690   27.3943   27.0250   26.5801   25.9384   25.4950   25.3812   25.9797   26.2161   25.8529
   25.7229   25.4818   25.1988   24.6830   24.1923   24.6769   25.7953   26.8628   27.3902   27.4221
   23.5268   23.3170   22.8130   22.2007   22.5166   24.2156   26.0265   27.2429   27.8102   28.1406
   22.1065   21.6223   20.7820   20.2525   21.8779   24.1757   26.0179   27.1865   27.7925   28.0757
   21.8735   21.3565   20.3462   19.6492   21.5285   23.8496   25.5240   26.6964   27.1826   27.4780
   21.9366   21.6115   20.5934   19.5165   20.9647   23.0431   24.6515   25.7526   26.1567   26.5099
   21.5114   21.3184   20.3174   19.1090   19.8712   21.7516   23.4090   24.4323   25.0850   25.5011
   20.0658   20.1051   19.1655   18.0600   18.0617   20.0636   22.1554   23.2715   24.0884   24.6486
   17.8046   18.0234   17.2191   16.0531   15.5082   17.7296   20.4175   22.1258   23.1965   23.9742
   16.8721   18.1626   17.2343   13.4044   10.5823   13.3939   17.9812   20.1909   21.8956   23.2072
   22.1575   22.0825   21.5443   19.6984   16.8564    7.8570   10.9615   16.3992   19.5002   21.4066
   24.9072   25.0769   24.6802   23.8772   22.3576   18.3177   16.3365    9.6351   13.2929   17.6503
   26.4864   26.5534   26.5450   26.4453   25.4516   24.3372   22.5470   18.7988   17.4149   12.9617
   27.3644   27.8307   27.8748   28.0661   27.5458   26.9100   25.5901   23.6366   22.8438   20.4205
   27.8425   28.4026   28.9150   29.0020   28.7434   28.2052   27.4765   26.5243   25.2220   23.2677
   28.4434   28.8837   29.3067   29.3256   29.1310   28.6223   27.8905   26.9707   25.7365   23.9725
   29.1798   29.3876   29.4068   29.3989   29.0778   28.4833   27.7072   26.7354   25.4511   23.6497
   29.4864   29.5167   29.3556   29.1367   28.4833   27.4645   26.3352   25.0700   23.3489   21.2354
   29.5241   29.4529   29.0087   28.2836   27.1767   25.3938   23.4168   21.0613   18.2876   15.0390
   29.4381   29.1389   28.4050   27.2420   25.1817   22.4731   19.0382   15.0803   17.3743   19.4821
   29.3299   28.7636   27.7532   25.9997   23.4310   20.0484   18.5566   19.4077   21.4437   23.6432
   29.2147   28.4853   27.3365   25.2378   22.4733   19.9921   20.9246   22.8655   24.1350   25.4541
   28.7883   27.9762   26.8367   24.8851   22.4760   20.8857   22.2391   24.1123   25.5143   26.2346
   ];

   rho(:,11:19) = rho(:,9:-1:1);
end
